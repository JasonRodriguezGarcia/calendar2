ğŸ”¹ Flujo completo de desarrollo y producciÃ³n (React + Vite + Express + Docker Compose)
0ï¸âƒ£ Idea clave

Desarrollo: React + Vite y Express ESM sin Docker.

ProducciÃ³n: ImÃ¡genes Docker construidas por GitHub Actions; el servidor solo ejecuta contenedores, no necesita Node, npm ni Vite.

ğŸ§± 0ï¸âƒ£0ï¸âƒ£ Requisitos previos para Windows Server 2022

    EdiciÃ³n Standard o Datacenter âœ…
    Acceso como Administrador
    Windows actualizado
    PowerShell como Administrador

ğŸ³ 0ï¸âƒ£1ï¸âƒ£ Instalar feature Containers
    Install-WindowsFeature -Name Containers
    Restart-Computer

ğŸ³ 0ï¸âƒ£2ï¸âƒ£ Instalar Docker Engine y Docker Compose
Usando el mÃ©todo soportado y actualizado:
    # Descargar script oficial de Microsoft
    Invoke-WebRequest `
    "https://raw.githubusercontent.com/microsoft/Windows-Containers/Main/helpful_tools/Install-DockerCE/install-docker-ce.ps1" `
    -UseBasicParsing -OutFile install-docker-ce.ps1

    # Ejecutar instalaciÃ³n
    .\install-docker-ce.ps1
    Restart-Computer

Verificar instalaciÃ³n:
    docker version
    docker compose version
    docker info | Select-String OSType

Debe mostrar:
    OSType: windows

Prueba de contenedor Windows nativo:
    docker run mcr.microsoft.com/windows/nanoserver:ltsc2022 cmd /c echo OK

âœ… Si imprime OK, Docker Engine y Docker Compose funcionan correctamente.

1ï¸âƒ£ Estructura del proyecto (en tu PC)
myapp/
â”œâ”€ frontend/          â† React + Vite
â”‚  â”œâ”€ src/            â† cÃ³digo React
â”‚  â”œâ”€ public/         â† archivos estÃ¡ticos
â”‚  â”œâ”€ package.json
â”‚  â”œâ”€ vite.config.js
â”‚  â”œâ”€ Dockerfile      â† PRODUCCIÃ“N: usado solo por GitHub Actions
â”‚  â””â”€ nginx.conf      â† PRODUCCIÃ“N
â”œâ”€ backend/           â† Express ESM
â”‚  â”œâ”€ server.js
â”‚  â”œâ”€ package.json
â”‚  â””â”€ Dockerfile      â† PRODUCCIÃ“N: usado solo por GitHub Actions
â”œâ”€ docker-compose.yml  â† PRODUCCIÃ“N en servidor
â”œâ”€ .env.example       â† variables sensibles de producciÃ³n
â””â”€ .gitignore


.gitignore recomendado:
    node_modules
    frontend/dist
    .env

2ï¸âƒ£ Desarrollo en tu PC
Frontend:
    cd frontend
    npm install
    npm run dev

React + Vite corre en: http://localhost:5173

Backend:
    cd backend
    npm install
    node server.js

Express corre en: http://localhost:3000

âš ï¸ En desarrollo NO se usan Dockerfiles ni Docker.

3ï¸âƒ£ Dockerfiles para producciÃ³n
Frontend Dockerfile (frontend/Dockerfile)
    # Build
    FROM node:18-alpine AS build
    WORKDIR /app
    COPY package*.json ./
    RUN npm install
    COPY . .
    RUN npm run build

    # Runtime
    FROM nginx:alpine
    COPY --from=build /app/dist /usr/share/nginx/html
    COPY nginx.conf /etc/nginx/nginx.conf
    EXPOSE 80

Backend Dockerfile (backend/Dockerfile)
    FROM node:18-alpine
    WORKDIR /app
    COPY package*.json ./
    RUN npm install --production
    COPY . .
    EXPOSE 3000
    CMD ["node", "server.js"]

Nginx config (frontend/nginx.conf)
server {
    listen 80;

    server_name _;

    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri /index.html;
    }

    location /api/ {
        proxy_pass http://backend:3000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

ğŸ”‘ /api/ se reenvÃ­a al contenedor backend.

4ï¸âƒ£ Subir el cÃ³digo a GitHub
    git init
    git add .
    git commit -m "Initial commit"
    git push origin main


Repo final contiene:
    CÃ³digo frontend y backend
    Dockerfiles para producciÃ³n
    nginx.conf
    .env.example

5ï¸âƒ£ GitHub Actions â€” Build y deploy de producciÃ³n
Archivo de workflow: .github/workflows/build-and-push.yml
    name: Build and Push Docker Images

    on:
    push:
        branches:
        - main

    jobs:
    build:
        runs-on: ubuntu-latest

        env:
        REGISTRY: ghcr.io/usuario

        steps:
        - name: Checkout repository
            uses: actions/checkout@v3

        - name: Set up Node.js
            uses: actions/setup-node@v3
            with:
            node-version: 18

        # --- Frontend ---
        - name: Install frontend dependencies
            run: |
            cd frontend
            npm ci

        - name: Build frontend
            run: |
            cd frontend
            npm run build

        - name: Build frontend Docker image
            run: |
            docker build -t $REGISTRY/frontend:latest ./frontend

        - name: Log in to GitHub Container Registry
            uses: docker/login-action@v2
            with:
            registry: ghcr.io
            username: ${{ github.actor }}
            password: ${{ secrets.GHCR_TOKEN }}

        - name: Push frontend image
            run: |
            docker push $REGISTRY/frontend:latest

        # --- Backend ---
        - name: Install backend dependencies
            run: |
            cd backend
            npm ci --production

        - name: Build backend Docker image
            run: |
            docker build -t $REGISTRY/backend:latest ./backend

        - name: Push backend image
            run: |
            docker push $REGISTRY/backend:latest


ğŸ”‘ GHCR_TOKEN debe configurarse como secret en GitHub.
TambiÃ©n se puede usar Docker Hub cambiando login y registry.

6ï¸âƒ£ Preparar el servidor (Windows Server 2022)
    Instalar Docker Engine y Docker Compose (ver secciÃ³n ğŸ³ 0ï¸âƒ£2ï¸âƒ£)
    No instalar Node, npm ni Vite
    Crear directorio para ejecutar Compose:

    C:\projects\myapp
    â”œâ”€ docker-compose.yml
    â”œâ”€ .env

7ï¸âƒ£ Docker Compose para producciÃ³n (docker-compose.yml)
    version: "3.9"

    services:
    frontend:
        image: ghcr.io/usuario/frontend:latest
        container_name: frontend
        ports:
        - "80:80"
        depends_on:
        - backend
        networks:
        - myapp-network

    backend:
        image: ghcr.io/usuario/backend:latest
        container_name: backend
        environment:
        - SUPABASE_URL=${SUPABASE_URL}
        - SUPABASE_KEY=${SUPABASE_KEY}
        networks:
        - myapp-network

    networks:
    myapp-network:
        driver: bridge


Variables de Supabase se definen en .env:
    SUPABASE_URL=https://xxxx.supabase.co
    SUPABASE_KEY=xxxx

8ï¸âƒ£ Ejecutar Docker en el servidor
    cd C:\projects\myapp

    # Descargar imÃ¡genes si no estÃ¡n locales
    docker pull ghcr.io/usuario/frontend:latest
    docker pull ghcr.io/usuario/backend:latest

    # Levantar contenedores
    docker compose up -d

âœ… El servidor solo ejecuta contenedores, no compila nada, no necesita Node ni Vite ni Dockerfiles.

9ï¸âƒ£ Estructura final en el servidor
C:\projects\myapp
â”œâ”€ frontend/
â”‚  â”œâ”€ Dockerfile       â† PRODUCCIÃ“N: usado solo por GitHub Actions
â”‚  â””â”€ nginx.conf
â”œâ”€ backend/
â”‚  â”œâ”€ server.js
â”‚  â”œâ”€ package.json
â”‚  â””â”€ Dockerfile       â† PRODUCCIÃ“N: usado solo por GitHub Actions
â”œâ”€ docker-compose.yml
â””â”€ .env

dist/ NO existe en el servidor.
Frontend corre React build servido por Nginx dentro del contenedor.
Backend corre Express dentro del contenedor.

ğŸ”Ÿ Resumen visual del flujo
Entorno	QuÃ© pasa
PC (desarrollo)	React + Vite (npm run dev), Node backend (node server.js) âœ…
GitHub Actions	Construye dist, crea imÃ¡genes Docker usando Dockerfiles âœ…
Servidor	Docker Compose levanta contenedores âœ…, no necesita Node/Vite âŒ
âœ… Frase clave:

En desarrollo no se usan Dockerfiles ni Docker.
Dockerfiles existen en el repo para GitHub Actions, y el servidor solo ejecuta contenedores desde PowerShell.

Si quieres, puedo hacer la versiÃ³n final â€œready for production con HTTPS automÃ¡tico y .env.exampleâ€, lista para levantar todo con un solo docker compose up -d y SSL con Let's Encrypt en Windows Server 2022.

Â¿Quieres que haga esa versiÃ³n tambiÃ©n?
*********************
*********************
EN CASO DE CAMBIAR CÃ“DIGO DE FRONTEND O BACKEND EN DESARROLLO
    Cambias cÃ³digo en frontend o backend â†’ lo haces en tu PC.
    Haces push a GitHub â†’ GitHub Actions:
        Construye el frontend (dist) y backend.
        Genera nuevas imÃ¡genes Docker.
        Las sube a GHCR (o Docker Hub).

    En el servidor:
        Solo necesitas descargar las nuevas imÃ¡genes y reiniciar contenedores:
            docker compose pull
            docker compose up -d


âœ… Esto reemplaza automÃ¡ticamente el cÃ³digo de los contenedores por las nuevas versiones.
âš ï¸ No hace falta instalar Node, Vite, npm ni reconstruir nada en el servidor.

En otras palabras: el servidor nunca compila nada, solo ejecuta contenedores con el cÃ³digo ya compilado que llega desde GitHub Actions.

Si quieres, puedo dibujarte un mini-diagrama de flujo â€œcÃ³digo â†’ GitHub Actions â†’ servidorâ€, que deja clarÃ­simo este paso de actualizaciÃ³n de contenedores. Esto ayuda mucho para documentar el proceso.

Â¿Quieres que lo haga?
*********************
*********************
