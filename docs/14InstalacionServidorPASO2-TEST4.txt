ğŸ”¹ Flujo completo de desarrollo y producciÃ³n (React + Vite + Express + Docker Compose)
0ï¸âƒ£ Idea clave

Desarrollo: React + Vite y Express ESM sin Docker

ProducciÃ³n: ImÃ¡genes Docker construidas por GitHub Actions, servidor solo ejecuta contenedores

1ï¸âƒ£ Estructura del proyecto (en tu PC)
myapp/
â”œâ”€ frontend/          â† React + Vite
â”‚  â”œâ”€ src/            â† cÃ³digo React
â”‚  â”œâ”€ public/         â† archivos estÃ¡ticos
â”‚  â”œâ”€ package.json
â”‚  â”œâ”€ vite.config.js
â”‚  â”œâ”€ Dockerfile      â† PRODUCCIÃ“N: NO se usa en desarrollo
â”‚  â””â”€ nginx.conf      â† PRODUCCIÃ“N
â”œâ”€ backend/           â† Express ESM
â”‚  â”œâ”€ server.js
â”‚  â”œâ”€ package.json
â”‚  â””â”€ Dockerfile      â† PRODUCCIÃ“N: NO se usa en desarrollo
â”œâ”€ docker-compose.yml  â† PRODUCCIÃ“N en servidor
â””â”€ .gitignore

.gitignore recomendado
    node_modules
    frontend/dist

2ï¸âƒ£ Desarrollo en tu PC

Frontend:
    cd frontend
    npm install
    npm run dev

React + Vite corre en http://localhost:5173

Backend:
    cd backend
    npm install
    node server.js

Express corre en http://localhost:3000

âš ï¸ En desarrollo NO se usan Dockerfiles ni Docker.

3ï¸âƒ£ Dockerfiles para producciÃ³n

Frontend Dockerfile (frontend/Dockerfile)
    # Build
    FROM node:18-alpine AS build
    WORKDIR /app
    COPY package*.json ./
    RUN npm install
    COPY . .
    RUN npm run build

    # Runtime
    FROM nginx:alpine
    COPY --from=build /app/dist /usr/share/nginx/html
    COPY nginx.conf /etc/nginx/nginx.conf
    EXPOSE 80


Backend Dockerfile (backend/Dockerfile)
    FROM node:18-alpine
    WORKDIR /app
    COPY package*.json ./
    RUN npm install --production
    COPY . .
    EXPOSE 3000
    CMD ["node", "server.js"]


Nginx config (frontend/nginx.conf)
    server {
        listen 80;

        server_name _;

        root /usr/share/nginx/html;
        index index.html;

        location / {
            try_files $uri /index.html;
        }

        location /api/ {
            proxy_pass http://backend:3000/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

ğŸ”‘ /api/ se reenvÃ­a al contenedor backend

4ï¸âƒ£ Subir el cÃ³digo a GitHub
    git init
    git add .
    git commit -m "Initial commit"
    git push origin main


Ahora tu repo contiene:
    CÃ³digo frontend y backend
    Dockerfiles (producciÃ³n)
    nginx.conf

5ï¸âƒ£ GitHub Actions â€” Build y deploy de producciÃ³n

Archivo de workflow (.github/workflows/build-and-push.yml):

name: Build and Push Docker Images

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      REGISTRY: ghcr.io/usuario

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      # --- Frontend ---
      - name: Install frontend dependencies
        run: |
          cd frontend
          npm ci

      - name: Build frontend
        run: |
          cd frontend
          npm run build

      - name: Build frontend Docker image
        run: |
          docker build -t $REGISTRY/frontend:latest ./frontend

      - name: Log in to GitHub Container Registry
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GHCR_TOKEN }}

      - name: Push frontend image
        run: |
          docker push $REGISTRY/frontend:latest

      # --- Backend ---
      - name: Install backend dependencies
        run: |
          cd backend
          npm ci --production

      - name: Build backend Docker image
        run: |
          docker build -t $REGISTRY/backend:latest ./backend

      - name: Push backend image
        run: |
          docker push $REGISTRY/backend:latest


ğŸ”‘ GHCR_TOKEN debe configurarse como secret en tu repo (Settings â†’ Secrets)

ğŸ”‘ TambiÃ©n puedes usar Docker Hub en lugar de GHCR, cambiando el login y el registry.

6ï¸âƒ£ Preparar el servidor (Windows Server 2022)
Instalar Docker Engine + Docker Compose
No instalar Node, npm ni Vite
Crear directorio para ejecutar Compose:

C:\projects\myapp
â”œâ”€ docker-compose.yml

7ï¸âƒ£ Docker Compose para producciÃ³n (docker-compose.yml)
version: "3.9"

services:
  frontend:
    image: ghcr.io/usuario/frontend:latest
    container_name: frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - myapp-network

  backend:
    image: ghcr.io/usuario/backend:latest
    container_name: backend
    environment:
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
    networks:
      - myapp-network

networks:
  myapp-network:
    driver: bridge


ğŸ”‘ Variables de Supabase se pueden definir en un .env en el servidor y se inyectan automÃ¡ticamente:

SUPABASE_URL=https://xxxx.supabase.co
SUPABASE_KEY=xxxx

8ï¸âƒ£ Ejecutar Docker en el servidor
cd C:\projects\myapp

# Descargar imÃ¡genes (si no estÃ¡n locales)
docker pull ghcr.io/usuario/frontend:latest
docker pull ghcr.io/usuario/backend:latest

# Levantar contenedores
docker compose up -d


âœ… El servidor solo ejecuta contenedores, no compila nada, no necesita Node ni Vite ni Dockerfiles.

9ï¸âƒ£ Estructura final en el servidor
C:\projects\myapp
â”œâ”€ frontend/
â”‚  â”œâ”€ Dockerfile       â† PRODUCCIÃ“N: usado solo por GitHub Actions
â”‚  â””â”€ nginx.conf
â”œâ”€ backend/
â”‚  â”œâ”€ server.js
â”‚  â”œâ”€ package.json
â”‚  â””â”€ Dockerfile       â† PRODUCCIÃ“N: usado solo por GitHub Actions
â””â”€ docker-compose.yml


dist NO existe en el servidor

Frontend corre React build servido por Nginx dentro del contenedor

Backend corre Express dentro del contenedor

ğŸ”Ÿ Resumen visual del flujo
Entorno	QuÃ© pasa
PC (desarrollo)	React + Vite (npm run dev), Node backend (node server.js) âœ…
GitHub Actions	Construye dist, crea imÃ¡genes Docker usando Dockerfiles âœ…
Servidor	Docker Compose levanta contenedores âœ…, no necesita Node/Vite âŒ

âœ… Frase final clave:
En desarrollo no se usan Dockerfiles ni Docker.
Dockerfiles existen en el repo para GitHub Actions, y el servidor solo ejecuta contenedores desde PowerShell.

Si quieres, puedo hacer la versiÃ³n final â€œlisto para producciÃ³n con HTTPS automÃ¡tico y .env.exampleâ€, donde solo con docker compose up -d tengas todo seguro y funcionando, incluyendo Nginx con SSL.

Â¿Quieres que haga esa versiÃ³n tambiÃ©n?
