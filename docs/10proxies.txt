Al desplegar el backend en Render, ten√≠a los siguientes comandos en index.js
    const allowedOrigins = [
    'http://localhost:5173',
    'https://calendar2-6wyj.onrender.com'
    ];

    app.use(cors({
    origin: (origin, callback) => {
        // Permitir solicitudes sin origin (como Postman) o si est√° en la lista
        if (!origin || allowedOrigins.includes(origin)) {
        callback(null, true);
        } else {
        callback(new Error('Origen no permitido por CORS'));
        }
    },
    credentials: true
    })); 

Y se muestra el siguiente error:

    Server running on http://localhost:10000 ValidationError: The 'X-Forwarded-For' header is set but the Express 
    'trust proxy' setting is false (default). 
    This could indicate a misconfiguration which would prevent express-rate-limit from accurately identifying users. 
    See https://express-rate-limit.github.io/ERR_ERL_UNEXPECTED_X_FORWARDED_FOR/ for more information. 
    at Object.xForwardedForHeader (file:///opt/render/project/src/backend/node_modules/express-rate-limit/dist/index.mjs:337:13) 
    at wrappedValidations.<computed> [as xForwardedForHeader] (file:///opt/render/project/src/backend/node_modules/express-rate-limit/dist/index.mjs:609:22) 
    at Object.keyGenerator (file:///opt/render/project/src/backend/node_modules/express-rate-limit/dist/index.mjs:711:20) 
    at file:///opt/render/project/src/backend/node_modules/express-rate-limit/dist/index.mjs:772:32 
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) 
    at async file:///opt/render/project/src/backend/node_modules/express-rate-limit/dist/index.mjs:753:5 
    { code: 'ERR_ERL_UNEXPECTED_X_FORWARDED_FOR', help: 'https://express-rate-limit.github.io/ERR_ERL_UNEXPECTED_X_FORWARDED_FOR/'
    ... bla bla bla }

express-rate-limit detecta que existe X-Forwarded-For pero que trust proxy est√° en false, y te lanza la advertencia porque 
as√≠ no podr√° identificar correctamente a los usuarios (pensar√° que todos vienen de la misma IP: la del proxy).
Simplemente dile a Express que conf√≠e en el proxy de Render.
Haz esto al inicio de tu archivo principal del servidor (por ejemplo, server.js o app.js):
// üëá A√±ade esta l√≠nea antes de usar express-rate-limit o cualquier middleware relacionado con IPs
app.set('trust proxy', 1); // 1 = conf√≠a en el primer proxy (Render, Heroku, etc.)
// Luego sigue con tus middlewares

üí° Por qu√© 1
El valor 1 indica que Express debe confiar en el primer proxy en la cadena de X-Forwarded-* headers (Render USA UNO).
    Cliente ‚Üí Cloudflare ‚Üí Express
Si usas m√°s proxies (por ejemplo, Cloudflare + Render), podr√≠as necesitar ajustar este n√∫mero o usar 
app.set('trust proxy', true) para confiar en todos. COSA NO RECOMENDABLE.
    Cliente ‚Üí Cloudflare ‚Üí Nginx ‚Üí Render ‚Üí Express (RECOMENDABLE PONER 3 en este caso)

Qu√© hace realmente true
Cuando pones true, Express conf√≠a en toda la cadena de proxies que puedan aparecer en la cabecera X-Forwarded-For.
Esto permite que, si en el futuro tu backend pasa por varios proxies (por ejemplo):
    Cliente ‚Üí Cloudflare ‚Üí Nginx ‚Üí Render ‚Üí Express (HABR√çA QUE PONER EL VALOR 3, QUE ES LO QUE HAY ENTRE CLIENTE Y EXPRESS)
Express a√∫n ser√° capaz de identificar correctamente la IP real del cliente, y tus middlewares que dependen de la IP 
(como express-rate-limit) seguir√°n funcionando bien. NO RECOMENDABLE
ESTO DA EL SIGUIENTE MENSAJE  EN CONSOLA DE BACKEND EN Render
ValidationError: The Express 'trust proxy' setting is true, which allows anyone to trivially bypass IP-based rate limiting. See https://express-rate-limit.github.io/ERR_ERL_PERMISSIVE_TRUST_PROXY/ for more information.
    at Object.trustProxy (file:///opt/render/project/src/backend/node_modules/express-rate-limit/dist/index.mjs:319:13)
    at wrappedValidations.<computed> [as trustProxy] (file:///opt/render/project/src/backend/node_modules/express-rate-limit/dist/index.mjs:609:22)
    at Object.keyGenerator (file:///opt/render/project/src/backend/node_modules/express-rate-limit/dist/index.mjs:710:20)
    at file:///opt/render/project/src/backend/node_modules/express-rate-limit/dist/index.mjs:772:32
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async file:///opt/render/project/src/backend/node_modules/express-rate-limit/dist/index.mjs:753:5 {
  code: 'ERR_ERL_PERMISSIVE_TRUST_PROXY',
  help: 'https://express-rate-limit.github.io/ERR_ERL_PERMISSIVE_TRUST_PROXY/'
}

PEEEROOOO... LO MEJOR ES AJUSTAR EL N√öMERO YA QUE SI DESPLIEGA TU BACKEND EN OTRO SITIO PUEDE QUE TENGA M√ÅS
PROXIES EN MEDIO Y PUEDE QUE DESCONOZCAMOS CUANTOS HAY.
Para detectar y advertir si la configuraci√≥n de trust proxy podr√≠a ser incorrecta.
config/proxy.js
export function configureTrustProxy(app) {
    let rawValue = process.env.TRUST_PROXY
    let trustProxyValue

    if (rawValue === undefined) {
        console.warn("‚ö†Ô∏èse√±al  Variable TRUST_PROXY no definida. Usando 'false' por defecto (sin confiar en proxies).")
        trustProxyValue = false
    } else if (rawValue === 'true') {
        trustProxyValue = true
    } else if (rawValue === 'false') {
        trustProxyValue = false
    } else {
        // trustProxyValue = parseInt(rawValue, 10)
        trustProxyValue = Number(rawValue)
        if (isNaN(trustProxyValue)) {
            console.warn(`‚ö†Ô∏è  Valor inv√°lido para TRUST_PROXY (${rawValue}). Usando 'false' por defecto.`)
            trustProxyValue = false
        }
    }

    // Guarda un valor de configuraci√≥n dentro de Express para el tema de los proxies
    // Se podr√≠a recuperar con app.get("trust proxy")
    app.set('trust proxy', trustProxyValue)
    console.log(`üîß Trust proxy configurado en: ${trustProxyValue}`)

  // Middleware para analizar X-Forwarded-For, SOLO FUNCIONA en modo producci√≥n porque es cuando hay X-Forwarded-For
  // porque nuestras peticiones fetch en frontend van directamente a express y no hay proxie en medio
    app.use((req, res, next) => {
        const forwardedFor = req.headers['x-forwarded-for']
        if (forwardedFor) {
            const chain = forwardedFor.split(',').map(ip => ip.trim())
            const clientIP = chain[0]; // IP original del cliente
            const numProxies = chain.length - 1 // cliente real + proxies
            
            // Calcula la IP que Express considera
            const expressIP = req.ip;
            const expressIPs = req.ips; // array de IPs seg√∫n trust proxy

            // Descomentar en caso diagn√≥stico para revisi√≥n de proxies
            // console.log(`üß© Cadena de proxies detectada (${chain.length}):`, chain);
            // console.log(`‚û°Ô∏è IP original del cliente: ${clientIP}`);
            // console.log(`‚û°Ô∏è IP considerada por Express (req.ip): ${expressIP}`);
            // console.log(`‚û°Ô∏è IPs confiables seg√∫n trust proxy (req.ips):`, expressIPs);

            // Detecta posible desajuste
            if (typeof trustProxyValue === 'number' && numProxies > trustProxyValue) {
                // Muestra informaci√≥n de diagn√≥stico
                console.warn(`‚ö†Ô∏è  Parece haber ${numProxies} proxies delante, pero 'trust proxy' est√° en ${trustProxyValue}.`)
                console.warn("üëâ  Considera aumentar TRUST_PROXY en tu .env para reflejar la cadena real.")
            }
        }
        next()
    })
}
En tu index.js
Solo tienes que importar y usarla antes de tus middlewares:

import express from "express";
import { configureTrustProxy } from "./config/proxy.js";

const app = express();

// Configura autom√°ticamente trust proxy seg√∫n entorno
configureTrustProxy(app);

üîç Qu√© hace esto

Detecta autom√°ticamente la cadena de IPs en la cabecera X-Forwarded-For.
Muestra por consola todas las IPs (cliente real + cada proxy intermedio).
Compara el n√∫mero de proxies detectados con tu valor de TRUST_PROXY.
Si hay m√°s proxies de los que conf√≠as, lanza un aviso tipo:
‚ö†Ô∏è  Parece haber 3 proxies delante, pero 'trust proxy' est√° en 1.
üëâ  Considera aumentar TRUST_PROXY en tu .env para reflejar la cadena real.
üí° Resultado pr√°ctico

As√≠, cuando muevas tu backend a otra plataforma (p. ej. de Render a AWS o Cloudflare), en cuanto llegue la primera 
petici√≥n real, ver√°s autom√°ticamente en consola si tu TRUST_PROXY se qued√≥ corto.
Esto te evita tener que adivinar la cantidad exacta de proxies del nuevo entorno.


La l√≠nea 
    req.headers['x-forwarded-for']
Nos da toda la cadena de proxies por los que ha pasado la petici√≥n, en el orden correcto.
Cuando una petici√≥n HTTP pasa por proxies o balanceadores, cada uno a√±ade su propia IP a la cabecera X-Forwarded-For.
Por ejemplo:
    X-Forwarded-For: 203.0.113.10, 198.51.100.5, 192.168.0.1
Eso significa:
    203.0.113.10 ‚Üí la IP del cliente real (usuario final).
    198.51.100.5 ‚Üí el primer proxy que recibi√≥ la petici√≥n del cliente.
    192.168.0.1 ‚Üí el √∫ltimo proxy antes de llegar a tu aplicaci√≥n Express.

Por tanto:
    req.headers['x-forwarded-for'].split(',').map(ip => ip.trim());


Te devuelve:
[
  "203.0.113.10",  // cliente real
  "198.51.100.5",  // proxy intermedio
  "192.168.0.1"    // proxy justo antes del servidor
]
Y qu√© hace Express con esto
Cuando configuras:
    app.set('trust proxy', 1);

Express ‚Äúconf√≠a‚Äù solo en el √∫ltimo proxy (el m√°s cercano) y considera que la IP real es la que est√° una posici√≥n antes 
en esa lista.
En el ejemplo anterior, Express usar√°:
    req.ip === "198.51.100.5"

Si conf√≠as en 2 proxies: 
    app.set('trust proxy', 2);

Entonces Express usar√°:
    req.ip === "203.0.113.10"

(es decir, sube un nivel m√°s en la cadena).
üß† En resumen
Configuraci√≥n	        IP que Express considera ‚Äúreal‚Äù	                        Cu√°ndo usar
trust proxy = false	    La IP del proxy m√°s cercano (no usa X-Forwarded-For)	Desarrollo local
trust proxy = 1	        La IP justo antes del √∫ltimo proxy	                    Render, Heroku
trust proxy = 2	        Sube un nivel m√°s en la cadena	                        Cloudflare + balanceador
trust proxy = 3	        IP original del cliente si hay 3 proxies	            Infra compleja

# En el caso a d√≠a de hoy (12Nov2025) solo hay 1 proxie entre el Cliente(nosotros) y Express que es Render:
#    Render (Cliente ‚Üí Cloudflare ‚Üí Express) Dicho proxi es confiable y se salta (TRUST_PROXY=1) para tener la ip del cliente
# Si en Render cambiase y hubiese m√°s o en un futuro se despliege la aplicaci√≥n en otro alojamiento web, cabe la 
# Posibilidad de que en el nuevo alojamiento hubiese m√°s proxies (TRUST_PROXY=3) en medio en los que confiar hasta tener
# la IP del cliente
#   (Cliente ‚Üí Cloudflare ‚Üí Nginx ‚Üí Render ‚Üí Express)


‚ö†Ô∏è Importante
Sin esta configuraci√≥n, express-rate-limit puede contar todas las solicitudes como si vinieran de una sola IP (la del proxy), 
lo que puede hacer que el rate limit se active incorrectamente.
